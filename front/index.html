<html>
<head>
  <title>Pokémon Collaborative Map</title>

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
  <link type="text/css" rel="stylesheet" href="css/index.css"  media="screen,projection"/>

  <script type="text/javascript" src="/socket.io/socket.io.js"></script>
  <script type="text/javascript" src="/js/store.min.js"></script>
  <script type="text/javascript" src="/js/config.js"></script>
</head>
<body>

  <header>
    <nav class="top-nav">
      <div class="card header-title">
        <div class="nav-wrapper">
          <div class="row">
            <div class="col s1">
              <a href="#" data-activates="leftmenu" style="padding-top:26px" class="page-title button-collapse full hide-on-large-only"><i class="material-icons">menu</i></a>
            </div>
            <div class="col s10 left">
              <a class="page-title left">Pokémon Go Map</a>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <div class="container"></div>
    <div class="side-nav fixed" id="leftmenu">
      <ul id="nav-mobile" class="" style="margin:0px">
      </ul>
    </div>
  </header>

  <main>
    <div class="row divider-top"></div>

    <div class="row container">
      <div id="map"></div>

      <a href="#modal_new_point" id="modal" class="hide">Modal</a>
      <div id="modal_new_point" class="modal bottom-sheet">
        <div class="modal-content">
          <h4>New Pokemon GO point</h4>
          <p>Here you will be able to select the type of event on your position</p>
          <div class="row">
            <div class="col s12">

              <div class="input-field col s12 m6">
                <select mclass="icons" id="types">
                </select>
                <label>Element sur la carte</label>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <a href="#!" id="types_validate" class=" modal-action waves-effect waves-green btn-flat">Ok</a>
          <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Cancel</a>
        </div>
      </div>

    </div>
  </main>

  <footer class="page-footer card">
    <div class="footer-copyright">
      <div class="container">
        © 2016 - Codlab
        <a class="grey-text text-lighten-4 right" href="https://github.com/codlab/pokemon_go_collab/blob/master/LICENSE">LGPL License</a>
      </div>
    </div>
  </footer>



  <script type="text/javascript" src="js/jquery.js"></script>
  <script type="text/javascript" src="js/materialize.js"></script>
  <script type="text/javascript" src="js/materialize.init.js"></script>
  <script type="text/javascript" src="js/maps.js"></script>
  <script type="text/javascript">

  function loadListing(){
    var i = 1;
    var select_code = "<option value=\"\" disabled selected>Choose your option</option>";
    select_code+= "<optgroup label=\"Lieux\">";
    select_code+= " <option value=\"90000\" data-icon=\"images/1.png\" class=\"circle\">PokéStop</option>";
    select_code+= " <option value=\"90001\" data-icon=\"images/1.png\" class=\"circle\">PokéGym</option>";
    select_code+= "</optgroup>";
    select_code+= "<optgroup label=\"Pokémon\">";
    for(;i<=151;i++){
      select_code+= " <option value=\""+i+"\" data-icon=\"images/"+i+".png\" class=\"circle\">#"+i+"</option>";
    }
    select_code+= "</optgroup>";

    $("#types").html(select_code);
    $("#types").material_select();
    $("#types").on("change", function (e) {
      var type = parseInt($("#types").val());
      if(type >= 1){
        $("#types").addClass("green");
      }else{

      }
    });

    console.log("init");
    $("#types_validate").click(function (e) {
      var type = parseInt($("#types").val());
      if(type >= 1){
        sendLocationWithType(type);
      }
    });


    // Configuration of the pokemon and point listing
    var ul = $("#modal_new_point").find("ul").first();

    ul.appendTo($("body").first());
    ul.css("z-index",9999);

    var state = ul.css("display")

    //detect whenever the user click on the list
    setInterval(function(){
      //if the state of the list changed > clicked
      if(ul.css("display") != state){
        //TODO? only when list visible
        state = ul.css("display");
        var item = $(".select-wrapper").first();

        var top = parseInt(ul.css("top"));
        var delta_top = item.offset().top;
        var delta_left = item.offset().left;
        if(top < delta_top){
          top += delta_top;
          ul.css("top", top+"px");
        }
        ul.css("left", delta_left+"px");
      }
    }, 300);
  }

  function height(element){
    return element.first().outerHeight(true);
  }

  function updateHeight(){
    var around = height($("footer")) + height($(".top-nav"));

    var margin = height($(".divider-top"));

    console.log("margin := "+margin);
    $("#map").height( window.innerHeight - around - margin);

    console.log($("#map").height());
  }

  $(function(){

    checkHTTPS();

    loadListing();

    $(window).resize(function() {
      updateHeight();
    });

    updateHeight();
  });

  </script>
</body>
</html>
